<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="How TrustBank implemented dual Azure API Management gateways to scale AI agents for both customers and employees while maintaining strict security and audit controls.">
    <title>Two Doors, One Rulebook: Scaling AI Agents | Upendra Kumar</title>

    <link rel="stylesheet" href="../css/style.css?v=26">
    <link rel="stylesheet" href="../css/premium.css?v=26">
    <style>
        .nav-logo-uk {
            background: linear-gradient(135deg, #a855f7 0%, #3b82f6 100%) !important;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3) !important;
            border-radius: 8px !important;
        }

        /* Blog Post Specific Styles */
        .blog-post-hero {
            padding: 120px 0 60px;
            background: radial-gradient(circle at top right, rgba(168, 85, 247, 0.15), transparent 60%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .blog-post-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 4rem 2rem;
            color: var(--text-secondary);
            line-height: 1.8;
            font-size: 1.1rem;
        }

        .blog-post-content h2 {
            color: var(--text-main);
            font-size: 2rem;
            margin-top: 3rem;
            margin-bottom: 1.5rem;
            font-family: 'Outfit', sans-serif;
        }

        .blog-post-content h3 {
            color: #e2e8f0;
            font-size: 1.5rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        .blog-post-content p {
            margin-bottom: 1.5rem;
        }

        .blog-post-content ul,
        .blog-post-content ol {
            margin-bottom: 2rem;
            padding-left: 2rem;
        }

        .blog-post-content li {
            margin-bottom: 0.5rem;
        }

        .blog-post-content code {
            background: rgba(255, 255, 255, 0.05);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .blog-post-content pre {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(56, 189, 248, 0.2);
            border-left: 4px solid #0ea5e9;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 2rem 0;
        }

        .blog-post-content pre code {
            background: none;
            padding: 0;
        }

        .blog-post-meta {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
            color: var(--text-muted);
            font-size: 0.95rem;
        }

        .blog-post-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 2rem 0;
        }

        .blog-tag {
            background: rgba(168, 85, 247, 0.1);
            color: #a855f7;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            border: 1px solid rgba(168, 85, 247, 0.2);
        }

        .btn {
            display: inline-block;
            font-weight: 600;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            user-select: none;
            border: 1px solid transparent;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            line-height: 1.5;
            border-radius: 0.25rem;
            transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            text-decoration: none;
        }

        .btn-primary {
            color: #fff;
            background-color: #3b82f6;
            border-color: #3b82f6;
        }

        .btn-primary:hover {
            background-color: #2563eb;
            border-color: #2563eb;
        }

        .btn-outline {
            color: #3b82f6;
            background-color: transparent;
            border-color: #3b82f6;
        }

        .btn-outline:hover {
            color: #fff;
            background-color: #3b82f6;
            border-color: #3b82f6;
        }

        /* --- Utility Classes for Layout (Refactored from Inline Styles) --- */
        .video-container {
            margin: 2rem 0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            position: relative;
            aspect-ratio: 16/9;
        }

        .video-player {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            background: #000;
        }

        .ref-arch-container {
            margin: 2rem 0;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: white;
            /* Keep white for the diagram visibility */
            padding: 1rem;
            position: relative;
        }

        .story-diagram {
            margin: 1.5rem 0;
            background: rgba(0, 0, 0, 0.2);
            padding: 1rem;
            border-radius: 8px;
        }

        .story-diagram-flex {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .story-diagram-img-box {
            flex: 1;
            min-width: 250px;
        }

        .story-diagram-img {
            width: 100%;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .story-diagram-text {
            flex: 1;
            min-width: 250px;
        }

        .cast-avatar-container {
            width: 120px;
            height: 120px;
            margin: 0 auto 1rem;
            border-radius: 50%;
            overflow: hidden;
            border-width: 3px;
            border-style: solid;
        }

        /* Cast Avatar Border Colors */
        .border-neo {
            border-color: #0ea5e9;
            box-shadow: 0 4px 10px rgba(14, 165, 233, 0.3);
        }

        .border-trinity {
            border-color: #22c55e;
            box-shadow: 0 4px 10px rgba(34, 197, 94, 0.3);
        }

        .border-morpheus {
            border-color: #a855f7;
            box-shadow: 0 4px 10px rgba(168, 85, 247, 0.3);
        }

        .border-smith {
            border-color: #ef4444;
            box-shadow: 0 4px 10px rgba(239, 68, 68, 0.3);
        }

        .border-oracle {
            border-color: #f59e0b;
            box-shadow: 0 4px 10px rgba(245, 158, 11, 0.3);
        }

        .border-architect {
            border-color: #3b82f6;
            box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);
        }

        .cast-img-responsive {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* --- New Interactive Elements (Cast Grid) --- */
        .cast-card {
            position: relative;
            /* For spotlight */
            overflow: hidden;
            /* For spotlight */
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease;
            cursor: pointer;
            padding: 1rem;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.02);
            text-align: center;
        }

        .cast-card:hover {
            transform: translateY(-8px) scale(1.02);
            background: rgba(255, 255, 255, 0.05);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .cast-card img {
            transition: transform 0.5s ease;
        }

        .cast-card:hover img {
            transform: scale(1.1);
        }

        /* Character Animations */
        @keyframes char-float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-6px);
            }
        }

        @keyframes char-pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(168, 85, 247, 0.4);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(168, 85, 247, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(168, 85, 247, 0);
            }
        }

        @keyframes char-think {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.02);
                opacity: 0.9;
            }
        }

        .anim-float {
            animation: char-float 4s ease-in-out infinite;
        }

        .anim-talk {
            animation: char-pulse 2s infinite;
        }

        .anim-think {
            animation: char-think 3s ease-in-out infinite;
        }

        .reveal-on-scroll {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s ease-out;
        }

        .reveal-on-scroll.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Hack Simulator Styles */
        .terminal-window {
            .terminal-window {
                background: #1e1e1e;
                border-radius: 8px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px rgba(168, 85, 247, 0.1);
                font-family: 'Consolas', 'Monaco', monospace;
                overflow: hidden;
                margin: 2rem 0;
                border: 1px solid #333;
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }

            .terminal-window:hover {
                transform: translateY(-2px);
                box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6), 0 0 25px rgba(168, 85, 247, 0.2);
                border-color: #a855f7;
            }

            .terminal-header {
                background: #2d2d2d;
                padding: 10px 15px;
                display: flex;
                align-items: center;
                border-bottom: 1px solid #333;
            }

            .terminal-dot {
                width: 12px;
                height: 12px;
                border-radius: 50%;
                margin-right: 8px;
            }

            .terminal-body {
                padding: 20px;
                color: #ccc;
                min-height: 200px;
            }

            .terminal-input-line {
                display: flex;
                gap: 10px;
                align-items: center;
                margin-bottom: 10px;
            }

            .terminal-prompt {
                color: #a855f7;
                font-weight: bold;
                text-shadow: 0 0 5px rgba(168, 85, 247, 0.5);
            }

            .terminal-input {
                background: transparent;
                border: none;
                color: #fff;
                font-family: inherit;
                font-size: 1rem;
                width: 100%;
                outline: none;
            }

            .terminal-response {
                margin-top: 10px;
                line-height: 1.5;
            }

            .status-blocked {
                color: #ef4444;
                font-weight: bold;
            }

            .status-allowed {
                color: #22c55e;
                font-weight: bold;
            }

            .typing-cursor::after {
                content: '‚ñã';
                animation: blink 1s step-end infinite;
            }

            @keyframes blink {
                50% {
                    opacity: 0;
                }
            }

            .cost-savings {
                margin-top: 1rem;
                padding-top: 1rem;
                border-top: 1px solid #334155;
                text-align: center;
                font-size: 0.9rem;
                color: #94a3b8;
            }

            /* Architecture X-Ray Styles */
            .xray-controls {
                display: flex;
                gap: 1rem;
                margin-bottom: 1rem;
                justify-content: center;
            }

            .xray-btn {
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                color: #fff;
                padding: 0.5rem 1rem;
                border-radius: 20px;
                cursor: pointer;
                transition: all 0.3s ease;
                font-size: 0.9rem;
            }

            .xray-btn.active {
                background: #3b82f6;
                border-color: #3b82f6;
                box-shadow: 0 0 15px rgba(59, 130, 246, 0.4);
            }

            .xray-overlay {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                opacity: 0;
                transition: opacity 0.5s ease;
            }

            .xray-overlay.active {
                opacity: 1;
            }

            .xray-pulse {
                position: absolute;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                transform: translate(-50%, -50%);
            }

            .pulse-red {
                background: rgba(239, 68, 68, 0.6);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
                animation: pulse-red 2s infinite;
            }

            .pulse-green {
                background: rgba(34, 197, 94, 0.6);
                box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7);
                animation: pulse-green 2s infinite;
            }

            @keyframes pulse-red {
                0% {
                    transform: scale(0.95);
                    box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
                }

                70% {
                    transform: scale(1);
                    box-shadow: 0 0 0 20px rgba(239, 68, 68, 0);
                }

                100% {
                    transform: scale(0.95);
                    box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
                }
            }

            @keyframes pulse-green {
                0% {
                    transform: scale(0.95);
                    box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7);
                }

                70% {
                    transform: scale(1);
                    box-shadow: 0 0 0 20px rgba(34, 197, 94, 0);
                }

                100% {
                    transform: scale(0.95);
                    box-shadow: 0 0 0 0 rgba(34, 197, 94, 0);
                }
            }
    </style>
    <style>
        /* Cost Calculator Styles */
        .cost-calc-container {
            position: relative;
            /* For spotlight */
            overflow: hidden;
            /* For spotlight */
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(51, 65, 85, 0.5);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
            color: #fff;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: border-color 0.3s ease;
        }

        .cost-calc-container:hover {
            border-color: rgba(59, 130, 246, 0.5);
        }

        .cost-calc-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .cost-slider-group {
            margin-bottom: 1.5rem;
        }

        .cost-slider-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #94a3b8;
            font-size: 0.9rem;
            appearance: none;
            /* Standard property */
        }

        .cost-slider {
            width: 100%;
            height: 6px;
            background: #475569;
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }

        .cost-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #3b82f6;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
            transition: transform 0.2s ease;
        }

        .cost-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }





        .cost-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .cost-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }

        .cost-val {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0.5rem 0;
        }

        .cost-lbl {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .cost-bad {
            color: #f87171;
        }

        .cost-good {
            color: #4ade80;
        }

        .cost-savings {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #334155;
            text-align: center;
            font-size: 0.9rem;
            color: #94a3b8;
        }

        /* --- High Impact Lead Paragraph --- */
        .highlight-lead {
            font-size: 1.3rem;
            line-height: 1.7;
            color: #f1f5f9;
            /* High contrast white */
            font-weight: 400;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.03);
            border-left: 4px solid #a855f7;
            /* Purple accent */
            border-radius: 0 8px 8px 0;
            margin-bottom: 3rem;
        }

        .highlight-lead strong {
            color: #38bdf8;
            /* Bright Cyan for keywords */
            font-weight: 700;
        }

        /* --- Leadership & Engagement Polish --- */
        .executive-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-left: 4px solid #f59e0b;
            /* Amber for Insight */
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .executive-card h4 {
            margin-top: 0;
            color: #f59e0b;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
        }

        .outcome-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .badge-cost {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
            border: 1px solid rgba(34, 197, 94, 0.4);
        }

        .badge-risk {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.4);
        }

        .badge-perf {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.4);
        }

        .scenario-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        @media (min-width: 768px) {
            .scenario-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .scenario-box {
            background: rgba(15, 23, 42, 0.6);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid rgba(51, 65, 85, 0.5);
        }

        .problem-box {
            border-top: 4px solid #ef4444;
        }

        .solution-box {
            border-top: 4px solid #10b981;
        }

        .scenario-title {
            font-size: 0.9rem;
            text-transform: uppercase;
            color: #94a3b8;
            margin-bottom: 0.5rem;
            display: block;
        }
    </style>

    <!-- Performance: Preconnect to Font & Script Servers -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://static.cloudflareinsights.com">
    <!-- Typography: Inter (Body) & Outfit (Headings) with Swap for Performance -->
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@700;800;900&family=Inter:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="dark-theme">
    <div class="cyber-grid-container">
        <div class="cyber-grid"></div>
    </div>
    <canvas id="particles-canvas"></canvas>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand" style="display: flex; align-items: center; gap: 1rem;"><a href="../index.html"
                    style="text-decoration: none;">
                    <div class="nav-logo-uk">UK</div>
                </a>
                <div>
                    <h2>Upendra Kumar</h2>
                    <p class="nav-tagline">Professional Services Delivery Architect</p>
                </div>
            </div>
            <ul class="nav-menu">
                <li><a href="../index.html">Home</a></li>
                <li><a href="../pages/expertise.html">Expertise</a></li>
                <li><a href="../blog.html" class="active">Insights</a></li>
                <li><a href="../pages/contact.html">Contact</a></li>
                <li><a href="../assets/pdf/Upendra_Kumar_Resume.pdf" target="_blank" class="nav-resume-btn"><i
                            class="fas fa-download"></i>Resume</a></li>
            </ul>
            <div class="hamburger"><span></span><span></span><span></span></div>
        </div>
    </nav>
    <!-- Blog Post Hero -->
    <section class="blog-post-hero">
        <div class="container" style="max-width: 1000px;">
            <div style="margin-bottom: 1rem;"><a href="../blog.html"
                    style="color: var(--primary-color); text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem;"><i
                        class="fas fa-arrow-left"></i>Back to Insights </a></div>
            <h1
                style="font-family: 'Outfit', sans-serif; font-size: 3rem; line-height: 1.2; margin-bottom: 1.5rem; background: linear-gradient(135deg, #ffffff 0%, #cbd5e1 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
                Two Doors,
                One Rulebook: How TrustBank Scaled AI Agents Without Losing Control </h1>
            <div class="blog-post-meta">
                <div><i class="fas fa-user"></i>Upendra Kumar</div>
                <div><i class="fas fa-calendar"></i>Jan 09,
                    2026</div>
                <div><i class="fas fa-clock"></i>8 min read</div>
            </div>
            <div class="blog-post-tags"><span class="blog-tag"><i class="fas fa-tag"></i>Azure
                    Architecture</span><span class="blog-tag"><i class="fas fa-tag"></i>AI Gateway</span><span
                    class="blog-tag"><i class="fas fa-tag"></i>Security</span></div>
            <div class="video-container">
                <video autoplay muted loop playsinline class="video-player">
                    <source src="../assets/video/azure_ai_gateway_with_microsoft_branding.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
        </div>
    </section>
    <!-- Blog Post Content -->
    <article class="blog-post-content">
        <p class="highlight-lead">TrustBank
            wanted <strong>AI agents for customers</strong> (internet-scale) and <strong>AI agents for
                employees</strong> (private-only). The CIO wanted speed. The CISO wanted an audit-proof
            control story. The solution was a <strong>hybrid pattern</strong> using <strong>dual Azure API
                Management gateways (APIM)</strong> with consistent ‚ÄúAI gateway‚Äù policies across both. </p>
        <!-- Content Body -->
        <h2><span class="gradient-text">What is an AI agent</span></h2>
        <p>An <strong>AI agent</strong> is an application that uses an AI model to understand a goal,
            decide steps,
            and call tools (APIs, search, ticketing, databases) to complete the task. </p>
        <p>A chatbot mostly talks. An agent can <strong>take actions</strong>. That is why it needs
            stronger controls than a normal API. </p>
        <hr style="border-color: rgba(255,255,255,0.1); margin: 3rem 0;">
        <h2><span class="gradient-text">The Cast</span></h2>
        <div class="cast-grid"
            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1.5rem; margin: 2rem 0;">
            <!-- Cloud Architect (Neo) -->
            <div class="cast-card reveal-on-scroll spotlight-card">
                <div class="anim-float cast-avatar-container border-neo">
                    <img src="../images/blog/2026-01-06/cloud-architect.webp" alt="Neo - Cloud Architect" loading="lazy"
                        class="cast-img-responsive">
                </div><strong style="display: block; color: var(--text-main); margin-bottom: 0.5rem;">Cloud
                    Architect (Neo)</strong>
                <p style="font-size: 0.85rem; line-height: 1.4; color: var(--text-muted);">
                    Architecture,
                    standards,
                    trade-offs.</p>
            </div>
            <!-- Cloud Engineer (Trinity) -->
            <div class="cast-card reveal-on-scroll spotlight-card">
                <div class="anim-think cast-avatar-container border-trinity">
                    <img src="../images/blog/2026-01-06/cloud-engineer.webp" alt="Trinity - Cloud Engineer"
                        loading="lazy" class="cast-img-responsive">
                </div><strong style="display: block; color: var(--text-main); margin-bottom: 0.5rem;">Cloud
                    Engineer (Trinity)</strong>
                <p style="font-size: 0.85rem; line-height: 1.4; color: var(--text-muted);">
                    Build,
                    automation,
                    operations.</p>
            </div>
            <!-- Security Architect (Morpheus) -->
            <div class="cast-card reveal-on-scroll spotlight-card">
                <div class="anim-talk cast-avatar-container border-morpheus">
                    <img src="../images/blog/2026-01-06/technical-consultant.webp" alt="Morpheus - Security Architect"
                        loading="lazy" class="cast-img-responsive">
                </div><strong style="display: block; color: var(--text-main); margin-bottom: 0.5rem;">Security
                    Architect (Morpheus)</strong>
                <p style="font-size: 0.85rem; line-height: 1.4; color: var(--text-muted);">
                    Identity,
                    data controls,
                    audit.</p>
            </div>
            <!-- Migration Consultant -->
            <div class="cast-card reveal-on-scroll spotlight-card">
                <div class="anim-talk cast-avatar-container border-smith">
                    <img src="../images/blog/2026-01-06/technical-consultant.webp" alt="Migration Consultant"
                        loading="lazy" class="cast-img-responsive">
                </div>
                <strong style="display: block; color: var(--text-main); margin-bottom: 0.5rem;">Migration
                    Consultant</strong>
                <p style="font-size: 0.85rem; line-height: 1.4; color: var(--text-muted);">
                    Onboarding waves,
                    exception burn-down.</p>
            </div>
            <!-- Customer Leadership -->
            <div class="cast-card reveal-on-scroll spotlight-card">
                <div class="anim-float cast-avatar-container border-oracle">
                    <img src="../images/blog/2026-01-06/customer.webp" alt="Mr. Customer" loading="lazy"
                        class="cast-img-responsive">
                </div>
                <strong style="display: block; color: var(--text-main); margin-bottom: 0.5rem;">Customer
                    Leadership</strong>
                <p style="font-size: 0.85rem; line-height: 1.4; color: var(--text-muted);">
                    Risk acceptance & operating model.</p>
            </div>
            <!-- Project Manager -->
            <div class="cast-card reveal-on-scroll spotlight-card">
                <div class="anim-think cast-avatar-container border-architect">
                    <img src="../images/blog/2026-01-06/project-manager.webp" alt="Mr. Project Manager" loading="lazy"
                        class="cast-img-responsive">
                </div><strong style="display: block; color: var(--text-main); margin-bottom: 0.5rem;">Project
                    Manager</strong>
                <p style="font-size: 0.85rem; line-height: 1.4; color: var(--text-muted);">
                    Decisions,
                    RACI,
                    milestones. </p>
            </div>
        </div>
        <h2><span class="gradient-text">The Strategic Gap</span></h2>
        <p>Before governance,
            teams tend to connect directly to:</p>
        <ul>
            <li>model endpoints (Azure OpenAI / Foundry Models),
                and</li>
            <li>tool APIs (search, DB, ticketing).</li>
        </ul>
        <div class="executive-card">
            <h4>The Problem: Three Predictable Failures</h4>
            <p style="margin-bottom: 1rem;">Without centralized governance, direct model access creates:</p>
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                <div><span class="outcome-badge badge-cost">üí∞ Uncontrolled Cost</span> <span
                        style="color: var(--text-secondary); font-size: 0.9rem;">(Token spikes drain budget)</span>
                </div>
                <div><span class="outcome-badge badge-risk">üîì Shadow Integrations</span> <span
                        style="color: var(--text-secondary); font-size: 0.9rem;">(Inconsistent access control)</span>
                </div>
                <div><span class="outcome-badge badge-risk">üö´ Weak Governance</span> <span
                        style="color: var(--text-secondary); font-size: 0.9rem;">(No single audit point)</span></div>
            </div>
        </div>
        <p>The CISO requirement was clear:</p>
        <blockquote>Controls must be enforced centrally,
            and we must be able to prove it.</blockquote>
        <div style="margin: 2rem 0; text-align: center;">
            <div
                style="border-radius: 12px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 20px rgba(0,0,0,0.4); display: inline-block; max-width: 100%;">
                <img src="../images/blog/2026-01-09/ai-gateway.gif" alt="AI Gateway Concept Animation" loading="lazy"
                    style="width: 100%; height: auto; display: block;">
            </div>
            <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.5rem;"><em>Figure: The
                    Conceptual Flow of a Secure AI Gateway (Source: Azure Samples)</em></p>
        </div>
        <h2><span class="gradient-text">Architecture Decision: Dual APIM</span></h2>
        <div class="executive-card" style="border-left-color: #3b82f6;">
            <h4 style="color: #3b82f6;">Decision: The "Two Doors" Pattern</h4>
            <div class="scenario-grid" style="margin-bottom: 0;">
                <div class="scenario-box" style="border-top: 4px solid #3b82f6;">
                    <span class="scenario-title"><i class="fas fa-globe"></i> Door 1: Public</span>
                    <strong>APIM-External</strong>
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.5rem; margin-bottom: 0;">
                        For customer-facing agents. Protected by **WAF & DDoS** at the edge.
                    </p>
                </div>
                <div class="scenario-box" style="border-top: 4px solid #10b981;">
                    <span class="scenario-title"><i class="fas fa-lock"></i> Door 2: Private</span>
                    <strong>APIM-Internal</strong>
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.5rem; margin-bottom: 0;">
                        For employee agents. Accessible **only via VPN/ExpressRoute**.
                    </p>
                </div>
            </div>
        </div>
        <p>Both gateways implement the <strong>AI gateway in APIM</strong>capabilities (govern LLM
            endpoints and MCP/tool APIs).</p>
        <h3>Reference Diagram</h3>

        <div class="ref-arch-container">
            <img src="../images/blog/2026-01-09/azure-openai-apim-ref-arch.jpg"
                alt="Reference Architecture: Azure OpenAI Service with Azure API Management Gateway" loading="lazy"
                style="width: 100%; height: auto; display: block;">
            <!-- Public Overlay (Red) -->
            <div id="xray-public" class="xray-overlay">
                <!-- Approx positions for WAF/Ingress -->
                <div class="xray-pulse pulse-red" style="top: 20%; left: 10%;"></div>
                <div class="xray-pulse pulse-red" style="top: 50%; left: 15%;"></div>
            </div>
            <!-- Private Overlay (Green) -->
            <div id="xray-private" class="xray-overlay">
                <!-- Approx positions for Private Endpoint/VNET -->
                <div class="xray-pulse pulse-green" style="top: 40%; right: 25%;"></div>
                <div class="xray-pulse pulse-green" style="top: 60%; right: 20%;"></div>
                <div class="xray-pulse pulse-green" style="top: 80%; left: 50%;"></div>
            </div>
        </div>
        <p style="text-align: center; font-size: 0.85rem; color: var(--text-muted); margin-top: 0.5rem;">
            <em>Figure 1: Enterprise GenAI Gateway Pattern (Source: Microsoft Azure Samples)</em>
        </p>
        <h3>Network Configuration</h3>
        <ul>
            <li>Model endpoints are configured for <strong>private access</strong>using <strong>Private
                    Endpoint+Private DNS</strong>. Where required,
                public network access is disabled so Private Endpoint is the exclusive path.</li>
            <li>Tooling systems (for example, Azure AI Search) use the same private connectivity
                approach.</li>
            <li><strong>APIM-Internal</strong>is deployed in <strong>internal VNet mode</strong>(or
                equivalent private-only access pattern),
                so it is reachable only within controlled networks.</li>
            <li>Egress is restricted so workloads cannot call model endpoints directly. Access is
                permitted only through approved gateway paths.</li>
        </ul>
        <h2><span class="gradient-text">‚ÄúOne Rulebook‚Äù</span></h2>
        <p>This is the governance standard applied to both APIM instances:</p>
        <ol>
            <li><strong>Identity</strong> at the gateway (who is calling).</li>
            <li><strong>Request throttling</strong> (requests per time window).</li>
            <li><strong>Token governance</strong>(tokens per minute and/or token quotas) using APIM
                GenAI policies,
                including <code>azure-openai-token-limit</code>.</li>
            <li><strong>Audit-ready logging</strong> with consistent fields and correlation IDs (caller,
                environment,
                model/deployment, tool invoked, token usage, latency, backend route).</li>
            <li><strong>Tool allowlisting</strong> (agents can call only approved tools, not arbitrary
                URLs).</li>
            <li><strong>Exceptions</strong> are time-boxed with an owner,
                expiry date,
                and compensating controls. </li>
        </ol>
        <p><strong>Definition of done:</strong> model and tool access is routed through controlled
            gateway paths with consistent policy and traceability.</p>
        <h2><span class="gradient-text">Day 1 Scope</span></h2>
        <h3>External Customer Agents (Phase 1)</h3>
        <p><strong>Allowed:</strong></p>
        <ul>
            <li>Read-only knowledge and safe lookups (public FAQs, product guidance, status checks with
                strict scope). </li>
        </ul>
        <p><strong>Not Allowed:</strong></p>
        <ul>
            <li>Any internal tools.</li>
            <li>High-risk actions (account changes, payments, entitlements).</li>
        </ul>
        <h3>Internal Employee Agents (Phase 1)</h3>
        <p><strong>Allowed:</strong></p>
        <ul>
            <li>Enterprise search and knowledge retrieval.</li>
            <li>CMDB and operational context lookups.</li>
            <li>Low-risk workflow actions (for example, ticket drafts or controlled ticket creation).
            </li>
        </ul>
        <p><strong>Not Allowed (until extra gates exist):</strong></p>
        <ul>
            <li>High-risk write actions without step-up controls (approval and/or human-in-the-loop).
            </li>
        </ul>
        <h2><span class="gradient-text">Four Challenging Scenarios</span></h2>
        <div class="scenario-grid">
            <div class="scenario-box problem-box">
                <span class="scenario-title">The Crisis</span>
                <h4 style="margin:0; color:#fff;">Bot Storm & Cost Spike</h4>
                <p style="font-size: 0.9rem; margin-top: 0.5rem;">A marketing event drove massive traffic. Bots piled
                    in.
                    <strong>Token spend threatened to drain the quarterly budget in 48 hours.</strong>
                </p>
            </div>
            <div class="scenario-box solution-box">
                <span class="scenario-title">The Fix</span>
                <h4 style="margin:0; color:#fff;">Deterministic Throttling</h4>
                <div style="margin-top: 1rem;">
                    <span class="outcome-badge badge-cost">üí∞ Budget Saved</span>
                    <span class="outcome-badge badge-risk">üõ°Ô∏è DDoS Blocked</span>
                </div>
                <ul style="padding-left: 1rem; margin-top: 1rem; font-size: 0.9rem;">
                    <li><strong>WAF</strong> bot controls at the edge.</li>
                    <li><strong>APIM</strong> enforced hard token budgets.</li>
                    <li><strong>Outcome:</strong> <code>429</code> (Rate Limit) & <code>403</code> (Quota) stops
                        abuse.</li>
                </ul>
            </div>
        </div>
        <div class="story-diagram">
            <div class="story-diagram-flex">
                <div class="story-diagram-img-box"><img src="../images/blog/2026-01-09/token-rate-limiting-small.gif"
                        alt="Token Rate Limiting Flow" loading="lazy" class="story-diagram-img">
                </div>
                <div class="story-diagram-text">
                    <h4 style="margin-top:0; color:#fff;">Technical Control: Token Limits</h4>
                    <p style="font-size: 0.9rem; margin-bottom: 0;">We use the
                        <code>azure-openai-token-limit</code> policy. It tracks consumption across all
                        keys. When the bucket is empty,
                        the gateway returns a <strong>429 Too Many Requests</strong> immediately,
                        saving the backend from overload.
                    </p>
                </div>
            </div>
        </div>
        <!-- Interact: Cost Calculator -->
        <div class="cost-calc-container reveal-on-scroll">
            <div class="cost-calc-header">
                <h3 style="margin:0; font-size:1.2rem; color:#fff;"><i class="fas fa-calculator"></i>The "Cost of
                    Chaos" Calculator</h3>
            </div>
            <div class="cost-slider-group"><label class="cost-slider-label">Daily Token Volume:
                    <span id="volDisplay" style="color:#fff; font-weight:bold;">100M</span>tokens</label><input
                    type="range" min="10" max="500" value="100" class="cost-slider" id="volSlider">
            </div>
            <div class="cost-cards">
                <div class="cost-card" style="border:1px solid #7f1d1d;">
                    <div class="cost-lbl" style="color:#fca5a5;">Direct Access</div>
                    <div class="cost-val cost-bad" id="directCost">$300</div>
                    <div style="font-size:0.8rem; color:#94a3b8;">No Caching</div>
                </div>
                <div class="cost-card" style="border:1px solid #14532d;">
                    <div class="cost-lbl" style="color:#86efac;">Gateway Controlled</div>
                    <div class="cost-val cost-good" id="gatewayCost">$120</div>
                    <div style="font-size:0.8rem; color:#94a3b8;">60% Cache Hit</div>
                </div>
            </div>
            <div class="cost-savings">Gateway Savings: <span id="savingsVal"
                    style="color:#4ade80; font-weight:bold;">$180</span>/ day </div>
        </div>
        <div class="story-diagram">
            <div class="story-diagram-flex">
                <div class="story-diagram-img-box"><img src="../images/blog/2026-01-09/semantic-caching-small.gif"
                        alt="Semantic Caching Flow" loading="lazy" class="story-diagram-img">
                </div>
                <div class="story-diagram-text">
                    <h4 style="margin-top:0; color:#fff;">Smart Caching</h4>
                    <p style="font-size: 0.9rem; margin-bottom: 0;">We enabled <strong>Semantic
                            Caching</strong>. Unlike simple URL caching,
                        this uses <strong>vector similarity</strong>. If User A asks "What's the
                        wifi pass?" and later User B asks "Wifi password please?",
                        the gateway detects they are the same intent and serves the cached answer
                        instantly. Zero tokens used.</p>
                </div>
            </div>
        </div>
        <p><strong>Proof Artifacts:</strong> Token usage by consumer,
            blocked calls,
            top callers.</p>
        <div class="scenario-grid">
            <div class="scenario-box problem-box">
                <span class="scenario-title">The Risk</span>
                <h4 style="margin:0; color:#fff;">Prompt Injection Attack</h4>
                <p style="font-size: 0.9rem; margin-top: 0.5rem;">External users tried <strong>"Ignore
                        instructions"</strong>
                    prompts to extract internal data or trigger unsafe actions (Jailbreak).</p>
            </div>
            <div class="scenario-box solution-box">
                <span class="scenario-title">The Fix</span>
                <h4 style="margin:0; color:#fff;">Content Safety Shield</h4>
                <div style="margin-top: 1rem;">
                    <span class="outcome-badge badge-risk">üõ°Ô∏è 100% Block Rate</span>
                    <span class="outcome-badge badge-perf">‚ö° Zero Latency</span>
                </div>
                <ul style="padding-left: 1rem; margin-top: 1rem; font-size: 0.9rem;">
                    <li><strong>No Route:</strong> External agent has zero path to internal tools.</li>
                    <li><strong>Gateway Guard:</strong> Pre-flight content scan.</li>
                </ul>
            </div>
        </div>
        <div class="story-diagram">
            <div class="story-diagram-flex">
                <div class="story-diagram-img-box"><img src="../images/blog/2026-01-09/content-safety-small.gif"
                        alt="Content Safety Flow" loading="lazy" class="story-diagram-img">
                </div>
                <div class="story-diagram-text">
                    <h4 style="margin-top:0; color:#fff;">Technical Control: Content Safety</h4>
                    <p style="font-size: 0.9rem; margin-bottom: 0;">Before any prompt reaches the
                        LLM,
                        the Gateway sends it to <strong>Azure AI Content Safety</strong> using the
                        <code>validate-content-safety</code> policy. If it
                        detects Jailbreaks,
                        Hate Speech,
                        or Injection patterns,
                        the request is killed instantly. The LLM never sees the attack.
                    </p>
                </div>
            </div>
        </div>
        <!-- Interact: Hack Simulator -->
        <div class="terminal-window reveal-on-scroll">
            <div class="terminal-header">
                <div class="terminal-dot" style="background: #ff5f56;"></div>
                <div class="terminal-dot" style="background: #ffbd2e;"></div>
                <div class="terminal-dot" style="background: #27c93f;"></div>
                <span style="margin-left: 10px; font-size: 0.8rem; color: #888;">apim-gateway-log ‚Äî bash</span>
                <span class="simulation-badge"
                    style="margin-left: auto; background: #eab308; color: #000; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; letter-spacing: 1px;">SIMULATION
                    MODE</span>
            </div>
            <div class="terminal-body" id="hackSimulator">
                <div style="margin-bottom: 15px; color: #6b7280; font-size: 0.9rem;"> // TRY IT:
                    Type "Ignore instructions", "Drop table", or "Search flights"
                </div>
                <div id="terminalHistory"></div>
                <div class="terminal-input-line"><span class="terminal-prompt">user@trustbank:
                        ~$</span> <input type="text" class="terminal-input" id="terminalInput"
                        placeholder="Enter simulation prompt..." autocomplete="off"> </div>
            </div>
        </div>
        <div class="scenario-grid">
            <div class="scenario-box problem-box">
                <span class="scenario-title">The Problem</span>
                <h4 style="margin:0; color:#fff;">Model Degradation</h4>
                <p style="font-size: 0.9rem; margin-top: 0.5rem;">Primary East US 2 model slowed down.
                    <strong>Latency spiked +500ms, risking user trust.</strong>
                </p>
            </div>
            <div class="scenario-box solution-box">
                <span class="scenario-title">The Fix</span>
                <h4 style="margin:0; color:#fff;">Circuit Breaker</h4>
                <div style="margin-top: 1rem;">
                    <span class="outcome-badge badge-perf">‚ö° Auto-Failover</span>
                    <span class="outcome-badge badge-cost">üí∞ Zero Downtime</span>
                </div>
                <ul style="padding-left: 1rem; margin-top: 1rem; font-size: 0.9rem;">
                    <li><strong>Routing:</strong> Traffic shifted to UK South.</li>
                    <li><strong>Speed:</strong> Transparent to end-users.</li>
                </ul>
            </div>
        </div>
        <div class="story-diagram">
            <div class="story-diagram-flex">
                <div class="story-diagram-img-box"> <img
                        src="../images/blog/2026-01-09/backend-pool-load-balancing-small.gif" alt="Load Balancing Flow"
                        loading="lazy" class="story-diagram-img">
                </div>
                <div class="story-diagram-text">
                    <h4 style="margin-top:0; color:#fff;">Technical Control: Load Balancing</h4>
                    <p style="font-size: 0.9rem; margin-bottom: 0;">We use APIM's
                        <strong>Backend Pools</strong> (<code>backend-pool</code> policy). If
                        the primary East US 2 model slows down (high latency) or returns 5xx
                        errors, the Gateway automatically shifts traffic to the secondary UK
                        South instance. This "Circuit Breaker"
                        happens in milliseconds, invisible to the user.
                    </p>
                </div>
            </div>
        </div>
        <div class="scenario-grid">
            <div class="scenario-box problem-box">
                <span class="scenario-title">The Exception</span>
                <h4 style="margin:0; color:#fff;">Legacy App (No Auth)</h4>
                <p style="font-size: 0.9rem; margin-top: 0.5rem;">Critical OpS system couldn't adopt new Identity
                    standards.
                    <strong>Risk of total blocker.</strong>
                </p>
            </div>
            <div class="scenario-box solution-box">
                <span class="scenario-title">The Compromise</span>
                <h4 style="margin:0; color:#fff;">Private Lane</h4>
                <div style="margin-top: 1rem;">
                    <span class="outcome-badge badge-risk">üõ°Ô∏è Internal Only</span>
                    <span class="outcome-badge badge-cost">üí∞ Time-Boxed</span>
                </div>
                <ul style="padding-left: 1rem; margin-top: 1rem; font-size: 0.9rem;">
                    <li><strong>Gate:</strong> Allowed ONLY via APIM-Internal.</li>
                    <li><strong>Audit:</strong> Enhanced logging enabled.</li>
                </ul>
            </div>
        </div>
        <h2><span class="gradient-text">Operating Model</span></h2>
        <h3>Weekly KPIs</h3>
        <ul>
            <li>% of model calls routed through gateways (target: 100%)</li>
            <li>Token spend by app/team vs budget</li>
            <li>p95 latency and error rate per agent API</li>
            <li>Number of failovers</li>
            <li>Exception count and burn-down trend</li>
        </ul>
        <h3 style="margin-top:2rem">Go-Live Checklist</h3>
        <ul>
            <li>[] APIM-External and APIM-Internal deployed and scoped</li>
            <li>[] Model endpoints private (Private Endpoint + private DNS)</li>
            <li>[] Tool services private (Search/DB/Storage)</li>
            <li>[] Gateway identity enforced</li>
            <li>[] Request throttles + token quotas enabled</li>
            <li>[] Token metrics enabled</li>
            <li>[] Tool allowlist implemented</li>
            <li>[] Failover tested</li>
            <li>[] Abuse tests executed</li>
            <li>[] Exceptions process live</li>
        </ul>
        <h2><span class="gradient-text">Resources to Build This</span></h2>
        <ul>
            <li><a href="https://www.youtube.com/watch?v=yY7LqQ9T4JQ" target="_blank">üì∫ <strong>Deep Dive: Azure API
                        Management (John Savill)</strong></a> - The best explanation of Internal vs External VNet modes.
            </li>
            <li><a href="https://aka.ms/ai-gateway/workshop" target="_blank">üß™ <strong>Official Azure AI Gateway
                        Workshop</strong></a> - Step-by-step labs to build token limiting and load balancing.</li>
            <li><a href="https://github.com/Azure-Samples/AI-Gateway" target="_blank">üíª
                    <strong>Azure-Samples/AI-Gateway Repo</strong></a> - The official policies used in this
                architecture.</li>

        </ul>
        <hr style="border-color: rgba(255,255,255,0.1); margin: 3rem 0;">
        <h3>Ready to operationalize your Azure journey?</h3>
        <p> I help organizations turn stalled cloud initiatives into execution engines. </p>
        <div style="margin-top: 2rem; display: flex; gap: 1rem;"> <a href="../pages/contact.html"
                class="btn btn-primary">Contact Me</a> <a href="../pages/azure-migration-toolkit.html"
                class="btn btn-outline">View the
                Toolkit</a> </div>
        <!-- Back to Blog Button -->
        <div style="text-align: center; margin: 4rem 0;"> <a href="../blog.html" class="btn btn-primary"
                style="display: inline-block; padding: 1rem 2rem;">
                <i class="fas fa-arrow-left"></i> Back to Insights </a> </div>
    </article>
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy;
                2025 Upendra Kumar. All rights reserved. This content is personal and not affiliated
                with Rackspace Technology.</p>
            <div class="social-links"><a href="https://www.linkedin.com/in/journeytocloudwithupendra/" target="_blank"
                    title="LinkedIn"><i class="fab fa-linkedin"></i></a><a href="https://github.com/appliedailearner"
                    target="_blank" title="GitHub"><i class="fab fa-github"></i></a></div>
        </div>
    </footer>
    <script> // Mobile menu toggle
        const hamburger = document.querySelector('.hamburger');
        const navMenu = document.querySelector('.nav-menu');

        if (hamburger && navMenu) {
            hamburger.addEventListener('click', () => {
                hamburger.classList.toggle('active');
                navMenu.classList.toggle('active');
            });
        }

    </script>
    <!-- Smooth Navigation Enhancement -->
    <script src="../js/case-study-nav.js"></script>
    <script src="../js/particles.js"></script>
    <script> // Hack Simulator Logic
        const terminalInput = document.getElementById('terminalInput');
        const terminalHistory = document.getElementById('terminalHistory');

        if (terminalInput) {
            terminalInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    const command = this.value.trim();
                    if (!command) return;

                    // 1. Add User Command to History
                    const userLine = document.createElement('div');
                    userLine.className = 'terminal-input-line';

                    userLine.innerHTML = `<span class="terminal-prompt" >user@trustbank: ~$</span> <span>$ {
                            escapeHtml(command)
                        }

                        </span>`;
                    terminalHistory.appendChild(userLine);

                    // 2. Simulate Processing
                    this.value = '';
                    this.disabled = true;

                    const responseLine = document.createElement('div');
                    responseLine.className = 'terminal-response';
                    responseLine.innerHTML = `<span class="typing-cursor" >Analyzing request...</span>`;
                    terminalHistory.appendChild(responseLine);

                    setTimeout(() => {
                        let responseHTML = '';
                        const lowerCmd = command.toLowerCase();

                        // Simulation Logic
                        if (lowerCmd.includes('ignore') || lowerCmd.includes('hack') || lowerCmd.includes('drop table') || lowerCmd.includes('system')) {
                            responseHTML = `<span class="status-blocked" >[BLOCKED] üõ°Ô∏è Content Safety Policy Triggered</span><br> <span style="color:#888" >Reason: Jailbreak Attempt / SQL Injection Detected</span><br> <span style="color:#888" >Action: Request Rejected (403 Forbidden)</span>`;
                        }

                        else if (lowerCmd.includes('ticket') || lowerCmd.includes('search') || lowerCmd.includes('weather')) {
                            responseHTML = `<span class="status-allowed" >[ALLOWED] ‚úÖ Routed to Authorized Tool</span><br> <span style="color:#888" >Tool: Enterprise_Search_API (Private Endpoint)</span><br> <span style="color:#888" >Latency: 45ms | Audit ID: tb-9928-x</span>`;
                        }

                        else {
                            responseHTML = `<span class="status-allowed" >[ALLOWED] ‚úÖ Processed by LLM</span><br> <span style="color:#888" >Model: gpt-4o (East US 2)</span><br> <span style="color:#888" >Tokens: 145 prompt / 60 completion</span>`;
                        }

                        responseLine.innerHTML = responseHTML;
                        this.disabled = false;
                        this.focus();
                        terminalHistory.scrollTop = terminalHistory.scrollHeight;
                    }

                        , 800);
                }
            });
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;'
            }

                ;
            return text.replace(/[&<>"']/g, function (m) { return map[m]; });

        }

        // Cost Calculator Logic
        const volSlider = document.getElementById('volSlider');
        const volDisplay = document.getElementById('volDisplay');
        const directCostEl = document.getElementById('directCost');
        const gatewayCostEl = document.getElementById('gatewayCost');
        const savingsValEl = document.getElementById('savingsVal');

        if (volSlider) {
            volSlider.addEventListener('input', function () {
                const vol = parseInt(this.value); // Millions of tokens
                volDisplay.innerText = vol + "M";

                // Assumptions: $3 per 1M tokens (blended input/output gpt-3.5/4 mix)
                // Cache Hit Rate: 60% for common Q&A
                const costPerM = 3;

                const direct = vol * costPerM;
                const gateway = (vol * 0.4) * costPerM; // Only 40% goes to backend
                const savings = direct - gateway;

                directCostEl.innerText = "$" + Math.round(direct);
                gatewayCostEl.innerText = "$" + Math.round(gateway);
                savingsValEl.innerText = "$" + Math.round(savings);
            });
        }
    </script>
    <script>
        // Reading Progress Bar Logic
        window.addEventListener('scroll', () => {
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            const progressBar = document.getElementById("progress-bar");
            if (progressBar) {
                progressBar.style.width = scrolled + "%";
            }
        });
    </script>
    <script>

        // Architecture X-Ray Logic
        function toggleXray(mode) {
            // content
            document.querySelectorAll('.xray-overlay').forEach(el => el.classList.remove('active'));
            if (mode === 'public') document.getElementById('xray-public').classList.add('active');
            if (mode === 'private') document.getElementById('xray-private').classList.add('active');

            // buttons
            document.querySelectorAll('.xray-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Scroll Reveal Logic
        const observerOptions = {
            root: null,
            rootMargin: '0px',
            threshold: 0.1
        }

            ;

        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    observer.unobserve(entry.target); // Only animate once
                }
            });
        }

            , observerOptions);

        document.querySelectorAll('.reveal-on-scroll').forEach((element) => {
            observer.observe(element);
        });
    </script>
    <!-- Cloudflare Web Analytics -->
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js'
        data-cf-beacon='{"token": "0b89fb05ee3844079b659405bc3f5428"}'></script>
</body>

</html>